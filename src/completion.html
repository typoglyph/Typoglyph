<!DOCTYPE html>
<html>
<head>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">
	
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Droid+Sans:700">
	<link rel="stylesheet" type="text/css" href="styles/main.css">
	
	<!-- see https://github.com/davidjbradshaw/iframe-resizer -->
	<script type="text/javascript" src="scripts/lib/iframe-resizer-v3.5.0/iframeResizer.contentWindow.min.js"></script>
	<script type="text/javascript" src="scripts/common.js"></script>
	<script type="text/javascript" src="scripts/util.js"></script>
	<script type="text/javascript" src="scripts/ui.js"></script>
	<script>
	
	
	// Imports
	var util = typoglyph.util;
	var PuzzleDrawer = typoglyph.ui.PuzzleDrawer;
	var PuzzleGapDrawer = typoglyph.ui.PuzzleGapDrawer;
	var PuzzleOptionDrawer = typoglyph.ui.PuzzleOptionDrawer;
	
	
	// Global variables
	var _currentPuzzle = null;	
	var _puzzleDrawer = null;
	var _onSkipListener = null;
	
	
	// Visible to other pages (when this page is embeded inside another)
	/**
	 * Displays the given statistics for the user
	 * 
	 * @param {StatisticsTracker} statsTracker
	 */
	function showResults(statsTracker) {
		var latestStat = statsTracker.getLatestStatistic();
		
		var resultElement = document.getElementById("result");
		resultElement.innerHTML = (latestStat.result ? "Correct!" : "Incorrect!");
		
		var puzzleElement = document.getElementById("puzzleAnswer");
		util.removeAllChildren(puzzleElement);
		_puzzleDrawer.drawInto(puzzleElement, latestStat.puzzle);
	}
	
	/**
	 * Sets up a listener to be called when the user decides to skip past the completion page. Pass
	 * null to remove any current listener.
	 * 
	 * @param {function()} listener
	 */
	function setOnSkipListener(listener) {
		_onSkipListener = listener;
	}
	
	// Event handlers
	/**
	 * Called when the browser has finished (re)loading the document
	 */
	function onLoad() {
		console.debug("onLoad");
		
		var optionDrawer = PuzzleOptionDrawer.create();
		var gapDrawer = PuzzleGapDrawer.create(optionDrawer, true);
		_puzzleDrawer = PuzzleDrawer.create(gapDrawer);
	}
	
	/**
	 * Called whenever the size of the viewport changes
	 * 
	 * @param {Event} event
	 */
	function onResize(event) {
		console.debug("onResize: event=" + event);
	}
	
	/**
	 * Called whenever the orientation of the device changes. Note browser support is spotty - some
	 * may call onResize(), some may call onOrientationChange(), some may all both, some may not
	 * call either
	 */
	function onOrientationChange(event) {
		console.debug("onOrientationChange: event=" + event);
	}
	
	/**
	 * @param {MouseEvent} event Information about the click event
	 * @param {HTMLElement} element The DOM element which was clicked
	 */
	function onClickAnywhere(event, element) {
		console.debug("onClickAnywhere: event=" + event + ", element=" + element);
		if (_onSkipListener !== null)
			_onSkipListener();
	}
	</script>
</head>
<body onload="onLoad();" onresize="onResize(event);" onorientationchange="onOrientationChange(event);" onclick="onClickAnywhere(event, this);">
	<h2 id="result"></h2>
	<div id="puzzleAnswer"></div>
</body>
</html>
